<!DOCTYPE html>
<html>
<head>
<title>
  Compose your own song lyrics, poetry or rap and improve your English - with an advanced rhyming dictionary based on CMUDict and speech formant synthesizer, as well as definition and translation, lookup of word forms or common phrases by part of speech, sentence parser and text editor with spell and grammar checking.
</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script type="text/javascript" src="piano.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<link rel="preconnect" href="https://fonts.gstatic.com"/>
<link href='https://fonts.googleapis.com/icon?family=Material+Icons' rel='stylesheet'/>
<style>
@font-face {
  font-family: "DejaVu";
  src: url("fonts/dejavu/DejaVuSansMono.ttf") format("truetype");
}
@font-face {
  font-family: "DejaVuBold";
  src: url("fonts/dejavu/DejaVuSansMono-Bold.ttf") format("truetype");
}
@font-face {
  font-family: "DejaVuSans";
  src: url("fonts/dejavu/DejaVuSans.ttf") format("truetype");
}
@font-face {
  font-family: "DejaVuSansBold";
  src: url("fonts/dejavu/DejaVuSans-Bold.ttf") format("truetype");
}
* {
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  font-family: 'DejaVu', 'DejaVuSans', monospace;
}
body, html {
  margin:0;
  padding:0;
  overflow:hidden;
  font-size:16px;
}
textarea, input, datalist, button, pre {
  font-size: 16px;
}
input, datalist, button {
  margin:0px;
  padding:0px 2px;
  border:1px solid lightgray;
}
ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
}
li {
  cursor: pointer;
  min-width:51%;
  float:left;
}
ul .d {
  color: darkgray;
  cursor: pointer;
  min-width:0%;
  max-width:16%;
  float:left;
  padding:0 4px;
}
sub {
  color: darkgray;
}
hr {
  margin:0;
  padding:0;
  border:1px solid black;
}
table {
  width:100%;
}
table, tbody, tr, td {
  border:0;
  padding:0;
  margin:0;
}
#spectrogram {
  padding:0;
}
#b {
  line-height:1.1em;
  letter-spacing:-0.15em;
  width:99%;
  height:224px;
  font-weight:bold;
  white-space:nowrap;
  overflow:scroll;
  background-color:white;
  color:black;
  margin:0;
  padding:2px;
  text-align:left;
}
#buttons {
  height:32px;
  margin-left:3px;
  text-align:left;
}
#buttons button {
  width:32px;
  height:32px;
  font-weight:bold;
  font-size:16px;
  margin:0px -3px;
}
#buttons button i {
  margin-top:3px;
}
#checkboxes {
  width:72px;
  position:fixed;
  top:25vh;
  right:0px;
  left:auto;
  padding-right:4px;
  background-color:white;
}
#p, #ch {
  position: absolute;
  right: -0.067em;
  top: 0.025em;
  font-size: 128px;
  font-weight: bold;
  line-height: 1em;
  z-index:-1;
}
#p {
  color:lightgray;
}
#left {
  width:32px;
  float:left;
  padding:2px;
}
#right {
  width:32px;
  float:right;
  padding:2px;
}
.cb {
  width:32px;
  height:32px;
  margin:0;
  padding:0;
  opacity:0;
}
#keys {
  width: 288px;
  margin:0px;
  font-size:16px;
}
#keys_ {
  width: 288px;
  margin:0px;
  font-size:16px;
  letter-spacing:-0.05px;
}
.u {
   text-decoration:underline;
}
a {
  color:black;
  text-decoration:none;
}
#keys a {
  border-left: 1px solid lightgray;
  margin: 0px -1px 0px 0px;
  padding:2.4px;
  font-family:'DejaVuBold';
}
#keys_ span a {
  border-left:1px solid lightgray;
  padding:0px;
  margin:0px -1px 0px 0px;
  font-family:'DejaVuBold';
}
#keys_ a {
  font-family:'DejaVuBold';
}
#tone {
  width:288px;
  height:1.5em;
  line-height:1.5em;
  overflow:scroll;
  background-color:transparent;
  margin-bottom:0.5em;
}
#tone a {
  text-decoration:underline;
  font-weight:bold;
  font-family:'DejaVuBold';
  padding:0px 1.8px;
}
select {
  height:24px;
  font-size:16px;
  width:24px;
  margin:0px;
  padding:2px 1px;
  border: 0px;
  -o-appearance: none;
  -ms-appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}
option {
  margin:0px;
  padding:0px;
}
#word, #word_ {
  border:1px solid lightgray;
  margin:0px;
  background:white;
  float:left;
}
#word {
  height:20px;
  width:224px;
  padding:1px 2px;
}
#word_ {
  overflow:scroll;
  height:18px;
  width:50%;
  padding:2px;
  margin:0px -4px;
}
#word_ div {
  padding:2px;
  cursor: pointer;
  height: 22px;
  border-bottom: 1px solid darkgray;
}
#word_ i {
  float: left;
  font-size: 16px;
}
#split, #search, #translate, #complete {
  width:29px;
  height:24px;
  border:1px solid lightgray;
  margin:0px;
  padding:2px;
  background:#eeeeee;
  float:right;
  font-size:14px;
}
#split i {
  font-size:14px;
  margin-top:4px;
  position:relative;
  right:2px;
  letter-spacing:-4px;
  font-weight:bold;
}
#search i {
  margin-top:-2px;
}
.l {
  width:100%;
  padding:0px;
  margin:0px;
  clear:both;
}
#vowels {
  width:148px;
  height:22px;
}
#consonants {
  width:128px;
  height:22px;
}
pre {
  padding:0px;
  margin:0px;
  letter-spacing:0px;
}
#highlight, #sidebar {
  width:50%;
  overflow-y:scroll;
  overflow-x:hidden;
  top:0px;
  position:fixed;
  z-index:-1;
  background:transparent;
  margin:0px;
  padding:0px;
  min-height:128px;
  font-size:16px;
  letter-spacing: 0px;
  line-height:1em;
}
#hl {
  margin:0px;
  padding:0px;
  border:none;
  color:transparent;
}
#hl b {
  position:relative;
  top:1px;
}
#hl i {
  position:relative;
  top:-8px;
  margin-bottom:-4px;
}
#hl sup {
  color:darkgray;
  line-height:0;
  position: relative;
  top: 0.5em;
}
#res {
  position:fixed;
  overflow-y:scroll;
  overflow-x:hidden;
  margin:-1px;
  padding:0px;
  border:1px solid lightgray;
  letter-spacing: 0px;
  background:transparent;
  min-height:128px;
  z-index:0;
  line-height:1em;
}
#highlight, #res {
  left:0px;
  text-align:left;
  display:block;
  white-space: pre;
}
#sidebar {
  right:0px;
  text-align:left;
  display:block;
}
#dict {
  width:288px;
  position:fixed;
  left:50%;
  margin-left:-159px;
  background:white;
  bottom:0px;
  visibility:hidden;
}
#links {
  border:1px solid lightgray;
  position:fixed;
  z-index:10;
  bottom:0px;
  right:0px;
  width:24px;
  padding-left:4px;
  overflow:hidden;
  white-space:nowrap;
  background:white;
  font-size:16px;
}
#links i {
  font-size:20px;
}
#resources, #credits, #spectrogram {
  overflow:scroll;
  font-size: 14px;
  height:264px;
  position:fixed;
  left:50%;
  margin-left:-160px;
  background:white;
  width:310px;
  max-width:100vw;
  border:1px solid lightgray;
  padding:2px 4px 2px 4px;
  visibility:hidden;
  z-index:11;
  top:0px;
}
#gt-nvframe {
  display:none;
}
#translation .material-icons {
  font-size: 16px;
  color: gray;
  top: 3px;
  position: relative;
}
#words {
  width:50%;
  float:left;
}
#translation {
  float:right;
  width:50%;
  max-height:128px;
  overflow:scroll;
}
#translation_ {
  float:right;
}
#chart_ {
  float:left;
  width:40%;
  max-height:128px;
  margin:0;
  overflow:scroll;
}
#chart_ a {
  float:right;
  position:relative;
  top:-128px;
}
#phrase {
  padding:2px;
  margin:0;
  border:1px;
  height:20px;
  width:100%;
  float:left;
}
#pos {
  width:36px;
  padding:2px;
  position:absolute;
  right:28px;
}
#translate {
  position:absolute;
  right:0px;
}
#languages, #corpus {
  width:100%;
}
#ngram {
  width:50%;
  float:right;
  background-color:white;
  border:1px solid lightgray;
}
#syntax {
  width:100%;
  overflow:scroll;
  visibility:visible;
}
#translation, #translation_, #syntax_chart, #examples {
  margin-right:30px;
}
.tree {
  background-color:transparent;
  border:0;
  margin:0;
  padding:0;
}
.tree_selected {
  text-decoration:underline;
  border:0;
  margin:0;
  padding:0;
}
#syntax * {
  border-color:darkgray;
}
#syntax_chart select {
  width: 3.4em;
  font-size: inherit;
  background-color:white;
}
#examples {
  max-height:256px;
  overflow:scroll;
  font-size:14px;
}
#examples iframe {
  border:1px solid lightgray;
}
#complete {
  font-weight:bold;
}
#mobile {
  position:absolute;
  background-color:white;
  border:1px solid lightgray;
  height:2.5em;
  width:128px;
  margin-left:-128px;
  margin-top:-3em;
  visibility:hidden;
  z-index:11;
  overflow:hidden;
  font-size:12px;
}
@media only screen and (max-height: 511px) {
  #highlight, #res {
    height:128px;
    width:100%;
  }
  #sidebar {
    top:128px;
    height:350px;
    width:100%;
  }
}
@media only screen and (min-height: 512px) {
  #highlight, #res {
    height:25vh;
    width:100%;
  }
  #sidebar {
    top:25vh;
    height:75vh;
    width:100%;
  }
}
@media only screen and (max-width: 511px) {
  #highlight, #res {
    height:128px;
    width:100%;
  }
  #sidebar {
    top:128px;
    height:350px;
    width:100%;
  }
}
@media only screen and (min-width: 512px) {
  #highlight, #res {
    height:100vh;
    width:50%;
  }
  #sidebar {
    top:0px;
    height:100vh;
    width:50%;
  }
}
</style>
</head>
<body onload="loadLanguages();loadWords();" onclick="var tg=event.target;mobile.style.top=event.pageY+'px';mobile.style.left=event.pageX+'px';while(!tg.title){tg=tg.parentNode;}if(tg.tagName){mobile.innerText=tg.title;}">
<!-- https://en.m.wiktionary.org/w/api.php?action=query&prop=revisions&titles=door&rvslots=*&rvprop=content&formatversion=2 -->
<!--https://etherpad.wikimedia.org/p/RYC4rG0XlnKEz-bbj3YO-->

<div id="area">
  <div id="highlight"><pre id="hl"></pre></div>
  <textarea placeholder="Lyrics" id="res" onkeyup="if(event.key=='Enter'){highlightText();}else if(event.key=='.' || event.key=='?' || event.key=='!'){getSentence();}else if(event.key==' ' || event.key=='Backspace' || event.key=='Delete' || event.ctrlKey || event.metaKey){colorPhonemes();}" onkeydown="if(event.key.length==1 && kbrd[event.key] && event.getModifierState('CapsLock') && !event.ctrlKey && !event.metaKey){addPhoneme(kbrd[event.key], 0);}" onmouseup="" ontouchup="" onfocus="ctl=this;" onscroll="highlight.scrollTop = this.scrollTop;highlight.scrollLeft = this.scrollLeft;" style="visibility:visible;"></textarea>
</div>

  <div id="spectrogram">
    <textarea placeholder="Speech formant spectrum" id="b" onkeydown="if(event.key!='ArrowRight' && event.key!='ArrowLeft' && event.key!='ArrowUp' && event.key!='ArrowDown' && event.key!='Enter' && event.key!='Backspace' && event.key!='Delete' && event.ctrlKey!==true && event.metaKey!==true || event.key==' '){event.preventDefault();keysPressed[kbrd[event.key]]=true;addBinary();}" onkeyup="if(event.key!='ArrowRight' && event.key!='ArrowLeft' && event.key!='ArrowUp' && event.key!='ArrowDown' && event.key!='Enter' && event.key!='Backspace' && event.key!='Delete' && event.ctrlKey!==true && event.metaKey!==true || event.key==' '){keysPressed[kbrd[event.key]]=false;}else if(event.key=='ArrowRight'||event.key=='ArrowLeft'){showColumn();playColumn();}else if(event.key=='ArrowUp'||event.key=='ArrowDown'){showColumn();}" onfocus="ctl=this;"></textarea>
    
    <div id="checkboxes" oncontextmenu="return false;">
      <div id="left">
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
      </div>
      <div id="right">
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
        <input type="checkbox" class="cb" onchange="addBinary();" ontouchend="this.click();"/>
      </div>
      <span id="p">⣿</span>
      <span id="ch">⠀</span>
    </div>
    
    <div id="buttons">
      <button type="button" id="play_all" onclick="if(playNow===true){pause();}else{playAll();}" title="Play / Pause"><i class='material-icons notranslate'>play_arrow</i></button>
      <button type="button" id="zoom_in" onclick="zoom(1);" title="Zoom in"><i class='material-icons notranslate'>zoom_in</i></button>
      <button type="button" id="zoom_out" onclick="zoom(-1);" title="Zoom out"><i class='material-icons notranslate'>zoom_out</i></button>
      <button type="button" id="save" onclick="save();" title="Save as text"><i class='material-icons notranslate'>save_alt</i></button>
      <!--<button type="button" id="log_scale" onclick="logScale();" title="Export to image"><i class='material-icons notranslate'>gradient</i></button>-->
      <button type="button" id="draw" onclick="window.open('https://katiefrogs.github.io/Dots-Converter/');" title="Import a drawing"><i class='material-icons notranslate'>draw</i></button>
      <button type="button" id="space" onclick="addBinary();" title="Add space"><i class='material-icons notranslate'>space_bar</i></button>
      <button type="button" id="swap" onclick="swap();" title="Move pattern to left or right"><i class='material-icons notranslate'>swap_horiz</i></button>
    </div>
  </div>

  <div id="resources">
    <p><a id="grammar_ref" href="javascript:window.open('https://simple.m.wikipedia.org/');" title="Simple English Wikipedia"><b><img src="icons/Wiki.svg" height="14" alt="Simple English Wikipedia"/> Simple English Wikipedia</b></a> is an English-language edition of the Wikipedia online encyclopedia written primarily in basic English. It was launched in 2001. Its simpler word structure and syntax can make the information easy to understand.
    </p>
    <p><a id="grammar_ref" href="javascript:window.open('https://www.bbc.co.uk/learningenglish/english/basic-grammar-guide');" title="Grammar"><b><img src="icons/BBC.svg" height="11" alt="British Broadcasting Corporation"/> Learning English</b></a> is a department of the BBC World Service devoted to English language teaching. It has won numerous awards, including two Eltons from the British Council and an English Speaking Union award for innovation in English language teaching. There were a number of series for teaching language comprehension with the help of song lyrics, such as Pop Words. It was usual for the major broadcasters in the 1950s to have a programme teaching the language of the country the broadcaster served.
    </p>
    <p><a id="vocabulary_ref" href="javascript:window.open('https://learningenglish.voanews.com/');" title="Vocabulary"><b><img src="icons/VOA.svg" height="11" alt="Voice of America"/> Learning English</b></a><br/>
      is a controlled version of the English language first used on 19 October 1959, and still presented daily by the United States broadcasting service Voice of America. World news and other programs are read one-third slower than regular VOA English. Reporters avoid idioms and use a core vocabulary of about 1500 words, plus any terms needed to explain a story. The intended audience is intermediate to advanced learners of English. In 1962 the VOA published the first edition of the <a href='http://docs.voanews.eu/en-US-LEARN/2014/02/15/7f8de955-596b-437c-ba40-a68ed754c348.pdf' target='_blank'><u>Word Book</u></a>.
    </p>
    <!-- https://www.ldoceonline.com/exercise/, routledge ?, https://lyricstranslate.com/ -->
  </div>
  
  <div id="mobile">On mobile, switch the system keyboard to floating mode.</div>
  
  <div id="credits">
    <p>Reverse phonetic dictionary, includes a lyrics editor and vowel sound synthesizer. Licensed under the GNU GPL-3.0, hosted on <a href="https://github.com/freealise/phonetic" title="Github" target="_blank"><u>GitHub</u></a> and <a href="https://script.google.com" title="Google Script" target="_blank"><u>Google Script</u></a>.</p>
    <p>Dictionary by <a href="http://www.speech.cs.cmu.edu/cgi-bin/cmudict" title="Carnegie Mellon University" target="_blank"><u>CMU</u></a>, sorted by frequency based on <a href="https://books.google.com/ngrams" title="Google Books Ngrams" target="_blank"><u>Google Books Ngrams</u></a> with <a href="https://phrasefinder.io/" title="PhraseFinder" target="_blank"><u>PhraseFinder</u></a> API, <a href="https://dictionaryapi.dev/" title="DictionaryAPI" target="_blank"><u>definitions</u></a> by <a href="https://www.lexico.com/" title="Oxford Dictionary" target="_blank"><u>Oxford</u></a>.</p>
    <p>Thanks to <a href="https://www.gearspace.com/board/showpost.php?p=11559456&amp;postcount=10" title="jerry123 from GearSpace" target="_blank"><u>jerry123 from GearSpace</u></a> for the idea of phonetic songwriting, <a href="https://englishwithkim.com/" title="English with Kim" target="_blank"><u>English with Kim</u></a> for clarifying that words and syllables are stressed with not only volume but also pitch variation.</p>
    <p>Separating vowels and consonants for slant rhyme and alliteration within a line was inspired by rap and Hebrew poetry.</p>
  </div>
  
  <div id="sidebar">
    <div id="translations">
      <button onclick="if(phrase.value.search(/\W/g)!=-1){loadPhrases();}else if(phrase.value!=''){loadTranslations(phrase.value);}" id="translate" title="Translate"><i class='material-icons notranslate'>search</i></button>
      <input type="text" name="phrase" id="phrase" placeholder="Phrase" onfocus="ctl=this;" onkeydown="if(event.key=='_'){loadInflections(this.value);}"/>
      <input title="Part of speech" type="text" id="pos" size="2" list="pos_" placeholder="*" onchange="if(this.value.length==1){phrase.value=this.value;phrase.focus();}this.value='';">
      <datalist id="pos_" size="1">
            <option value="Options"></option>
            <option class="*" value="*">any word</option>
            <option class="," value=",">several</option>
            <option class="_INF" value="_">inflection</option>
            <option value="Part of speech"></option>
            <option class="_NOUN_" value="$">noun</option>
            <option class="_VERB_" value="=">verb</option>
            <option class="_ADJ_" value="%">adjective</option>
            <option class="_ADV_" value="~">adverb</option>
            <option class="_PRON_" value="|">pronoun</option>
            <option class="_DET_" value="^">determiner</option>
            <option class="_ADP_" value="@">adposition</option>
            <option class="_NUM_" value="#">numeral</option>
            <option class="_CONJ_" value=";">conjunction</option>
            <option class="_PRT_" value="`">particle</option>
            <option value="Sentence"></option>
            <option class="_ROOT_=>" value=">">root</option>
            <option class="_START_" value=":">start</option>
            <option class="_END_" value=".">end</option>
        </datalist>
        <!--
          _NOUN_		These tags can either stand alone or can be appended to a word (inflection always is)
          _VERB_
          _ADJ_	adjective
          _ADV_	adverb
          _PRON_	pronoun
          _DET_	determiner or article
          _ADP_	an adposition: either a preposition or a postposition
          _NUM_	numeral
          _CONJ_	conjunction
          _PRT_	particle
            _ROOT_	root of the parse tree	  These tags must stand alone (e.g., _START_)
            _START_	start of a sentence
            _END_	end of a sentence
        -->
      <div id="word_" class="notranslate" onclick="if(event.target.title){addWord(event.target.innerText, event.target.title);}"></div>
      <select disabled id="ngram" size="1" onfocus="this.selectedIndex=-1" onblur="this.selectedIndex=0" onchange="loadTranslation(this.options[this.selectedIndex].innerText);loadExamples(this.options[this.selectedIndex].innerText);if(phrase.value.split(' ').length<5){phrase.value=this.options[this.selectedIndex].innerText+' *';loadPhrases();}">
        <option selected>Phrasebook</option>
      </select>
      <div id="translation"><sub><i class='material-icons notranslate'>translate</i> Translation</sub></div>
      <div id="chart_"><sub><i class='material-icons notranslate'>legend_toggle</i> Word usage</sub></div>
    </div>
    <div id="syntax">
      <div id="translation_"></div>
      <div id="syntax_chart"><sub><i class='material-icons notranslate'>spellcheck</i> Grammar</sub></div>
    </div>
    <div id="examples"><sub><i class='material-icons notranslate'>grading</i> Examples</sub></div>
  </div>

  <div id="dict">
    <div class="l"><input type="text" id="word" list="_word" placeholder="Word or phonemes" onkeyup="if(a_c===false && this.value.length>2 && event.key!='ArrowRight' && event.key!='ArrowLeft'){autoCompleter(this.value);}" onfocus="ctl=this;"/><datalist id="_word"></datalist><button onclick="findWords();" id="search" title="Search"><i class='material-icons notranslate'>manage_search</i></button><button onclick="splitWord();" id="split" title="Split"><i class='material-icons notranslate'>south_west</i><i class='material-icons notranslate'>south_east</i></button></div>
    <div class="l"><input type="text" id="vowels" list="vowels_" placeholder="Vowels" onkeyup="if(a_c===false && this.value.length>1 && event.key!='ArrowRight' && event.key!='ArrowLeft'){loadIndex(this.value,'A');}" onfocus="ctl=this;"/><datalist id="_vowels"></datalist><datalist id="vowels_"></datalist><input type="text" id="consonants" list="consonants_" placeholder="Consonants" onkeyup="if(a_c===false && this.value.length>1 && event.key!='ArrowRight' && event.key!='ArrowLeft'){loadIndex(this.value,'B');}" onfocus="ctl=this;"/><datalist id="_consonants"></datalist><datalist id="consonants_"></datalist></div>
    
    <pre oncontextmenu="return false;" id="keys_">
<span class="notranslate"><span class="u"><a title="b">  </a><a title="p">  </a></span>         <span class="u"><a title="d">  </a><a title="t">  </a></span>  <span class="u"><a title="ʤ">  </a><a title="ʧ">  </a></span>   <span class="u"><a title="g">  </a><a title="k">  </a></span>
<span class="u"><a title="v">  </a><a title="f">  </a></span>  <span class="u"><a title="ð">  </a><a title="θ">  </a></span>   <span class="u"><a title="ʒ">  </a><a title="ʃ">  </a></span>  <span class="u"><a title="z">  </a><a title="s">  </a></span>   <span class="u"><a title="ɹ">  </a><a title="h">  </a></span>
<span class="u"><a title="w">  </a><a title="m">  </a></span>  <span class="u"><a title="_">  </a></span>     <span class="u"><a title="l">  </a><a title="n">  </a></span>         <span class="u"><a title="j">  </a><a title="ŋ">  </a></span></span>
          <a title="Wildcard" href="javascript:" onclick="addPhoneme('*', 'transparent');">* </a>       <a title="Non-breaking space" onmousedown="mobile.innerText=this.title;" href="javascript:" onclick="addPhoneme(' ', 'transparent');">⎵ </a></pre>
    <pre oncontextmenu="return false;" id="keys"><span class="notranslate"><select title="i"></select><select title="ɪ"></select><select title="eɪ"></select><select title="ɛ"></select><select title="æ"></select><select title="ə"></select><select title="ʌ"></select><select title="ɑ"></select><select title="ɔ"></select><select title="oʊ"></select><select title="ʊ"></select><select title="u"></select></span>
<a title="Any stress with any vowel" onmousedown="mobile.innerText=this.title;" href="javascript:" onclick="addPhoneme('_', 'transparent');"><span class="notranslate">_ </span></a><a title="No stress with any vowel" onmousedown="mobile.innerText=this.title;" href="javascript:" onclick="addPhoneme('_·', 'transparent');"><span class="notranslate">_·</span></a><a title="Primary stress with any vowel" onmousedown="mobile.innerText=this.title;" href="javascript:" onclick="addPhoneme('_ˈ', 'transparent');"><span class="notranslate">_ˈ</span></a><a title="Secondary stress with any vowel" onmousedown="mobile.innerText=this.title;" href="javascript:" onclick="addPhoneme('_ˌ', 'transparent');"><span class="notranslate">_ˌ</span></a><span class="notranslate"><select title="aɪ"></select><select title="ɔɪ"></select><select title="aʊ"></select></span></pre>
  <div title="Pitch symbols for word and syllable stress, span octave (12 semitones)" onmousedown="mobile.innerText=this.title;"><span id="tone" class="notranslate"></span></div>
  </div>
  
  <div id="links">
    <a id="undo" href="javascript:undo();" title="Undo"><i class='material-icons notranslate'>undo</i> Undo</a><br/>
    <a id="_examples" href="javascript:loadQuiz(false);" title="Quiz"><i class='material-icons notranslate'>grading</i> Quiz</a><br/>
    <a id="_syntax" href="javascript:showSyntax();" title="Sentences"><i class='material-icons notranslate' id='spellcheck'>spellcheck</i> Sentences</a><br/>
    <a id="show_words" href="javascript:showWords();" title="Words"><i class='material-icons notranslate'>translate</i> Words</a><br/>
    <a id="show_ph" href="javascript:showPhonemes();" title="Phonemes"><i class='material-icons notranslate'>keyboard_hide</i> Phonemes</a><br/>
    <a id="pattern" href="javascript:showSpectrogram();" title="Formants"><i class='material-icons notranslate'>app_registration</i> Formants</a><br/>
    <a id="mobile_view" href="javascript:showLyrics();" title="Mobile view"><i class='material-icons notranslate'>devices</i> Mobile view</a><br/>
    <a id="tooltips" href="javascript:showMobile();" title="Tooltips"><i class='material-icons notranslate'>wysiwyg</i> Tooltips</a><br/>
    <a id="resources_" href="javascript:showResources();" title="Resources"><i class='material-icons notranslate'>link</i> Resources</a><br/>
    <a id="credits_" href="javascript:showCredits();" title="Credits"><i class='material-icons notranslate'>copyright</i> Credits</a><br/>
    <a id="share" href="javascript:window.open('https://www.blogger.com/blog-this.g?t='+res.value, 'blog');" title="Share"><i class='material-icons notranslate'>share</i> Share</a><br/>
    <a id="show_language" href="javascript:showLinks();" title="Language"><i class='material-icons notranslate'>language</i></a> <select id="languages" size="1" onchange="sl=this.options[this.selectedIndex].value;langRedirect(true);"></select><br/>
    <a id="show_links" href="javascript:showLinks();" title="Show links"><i class='material-icons notranslate'>menu_open</i></a> <select id="corpus" size="1" onchange="">
          <option value="26">English 2019</option>
          <option value="28">American English 2019</option>
          <option value="29">British English 2019</option>
          <option value="27">English Fiction 2019</option>
          <option value="34">Chinese (simplified) 2019</option>
          <option value="30">French 2019</option>
          <option value="31">German 2019</option>
          <option value="35">Hebrew 2019</option>
          <option value="33">Italian 2019</option>
          <option value="36">Russian 2019</option>
          <option value="32">Spanish 2019</option>
          <option value="17">American English 2012</option>
          <option value="18">British English 2012</option>
          <option value="23">Chinese (simplified) 2012</option>
          <option value="15">English 2012</option>
          <option value="16">English Fiction 2012</option>
          <option value="19">French 2012</option>
          <option value="20">German 2012</option>
          <option value="24">Hebrew 2012</option>
          <option value="22">Italian 2012</option>
          <option value="25">Russian 2012</option>
          <option value="21">Spanish 2012</option>
          <option value="5">American English 2009</option>
          <option value="6">British English 2009</option>
          <option value="11">Chinese (simplified) 2009</option>
          <option value="0">English 2009</option>
          <option value="4">English Fiction 2009</option>
          <option value="1">English One Million 2009</option>
          <option value="7">French 2009</option>
          <option value="8">German 2009</option>
          <option value="9">Hebrew 2009</option>
          <option value="12">Russian 2009</option>
          <option value="10">Spanish 2009</option>
        </select><br/>
  </div>

<script>
var keys = [
  " i;IY;330;0.1664;0.3341;0.1498;0.0153;11",
  " ɪ;IH;300;0.3084;0.5288;0.3583;0.0380;10",
  "eɪ;EY;270;0.0699;0.0026;0.1882;0.0188;9",
  " ɛ;EH;240;0.1077;0.0145;0.2819;0.0266;8",
  " æ;AE;210;0.1024;0.0084;0.2871;0.0118;7",
  " ə;ER;180;0.1080;0.2535;0.0684;0.0021;6",
  " ʌ;AH;150;0.4567;1.0000;0.3641;0.0060;5",
  " ɑ;AA;120;0.0612;0.0046;0.1674;0.0115;4",
  " ɔ;AO;90;0.0557;0.0048;0.1554;0.0070;3",
  "oʊ;OW;60;0.0371;0.0182;0.0857;0.0075;2",
  " ʊ;UH;30;0.0112;0.0008;0.0310;0.0018;1",
  " u;UW;0;0.0605;0.0202;0.1523;0.0089;0",
  "aɪ;AY;210;0.0483;0.0066;0.1246;0.0138;0",
  "ɔɪ;OY;180;0.0034;0.0001;0.0098;0.0004;0",
  "aʊ;AW;90;0.0156;0.0006;0.0442;0.0021;0",
  //"__;__;0;0.0000;0.0000;0.0000;0.0000;0",
];

var keys_ = [
  "b,B,0.2141,35",
  "p,P,0.2477,36",
  "d,D,0.5656,37",
  "t,T,0.9327,38",
  "ʤ,JH,0.0791,33",
  "ʧ,CH,0.0717,32",
  "ɡ,G,0.0920,39",
  "k,K,0.3811,40",
  "v,V,0.2394,20",
  "f,F,0.2387,19",
  "ð,DH,0.6531,16",
  "θ,TH,0.0758,15",
  "ʒ,ZH,0.0086,18",
  "ʃ,SH,0.1072,17",
  "z,Z,0.4163,14",
  "s,S,0.5710,13",
  "ɹ,R,0.5663,24",
  "h,HH,0.1739,30",
  "w,W,0.2890,22",
  "m,M,0.3173,27",
  "_,_,1",
  "l,L,0.4471,25",
  "n,N,1.0000,28",
  "j,Y,0.0911,23",
  "ŋ,NG,0.1000,29",
];

var kbrd = {
  '`': '_',
  '1': 'i_',
  '2': 'ɪ_',
  '3': 'eɪ_',
  '4': 'ɛ_',
  '5': 'æ_',
  '6': 'ə_',
  '7': 'ʌ_',
  '8': 'ɑ_',
  '9': 'ɔ_',
  '0': 'oʊ_',
  '-': 'ʊ_',
  '=': 'u_',
  'q': 'θ',
  'w': 'w',
  'e': 'ʃ',
  'r': 'ɹ',
  't': 't',
  'y': 'ʤ',
  'u': 'ŋ',
  'i': 'ˈ',
  'o': '·',
  'p': 'p',
  '[': 'aɪ_',
  ']': 'ɔɪ_',
  '\\': 'aʊ_',
  'a': 'ʒ',
  's': 's',
  'd': 'd',
  'f': 'f',
  'g': 'g',
  'h': 'h',
  'j': 'j',
  'k': 'k',
  'l': 'l',
  ';': 'ˌ',
  '\'': '_',
  'z': 'z',
  'x': 'ð',
  'c': 'ʧ',
  'v': 'v',
  'b': 'b',
  'n': 'n',
  'm': 'm',
  ',': '_',
  '.': '_',
  '/': '_',
  '_': '_',
  ' ': ' ',
};

var superscript = {
  '·':'',
  'ˈ':'ˊ',
  'ˌ':'`',
  'a':'ᵃ',
  'i':'ⁱ',
  'ɪ':'ᶦ',
  'e':'ᵉ',
  'ɛ':'ᵋ',
  'æ':'ᵆ',
  'ə':'ᵊ',
  'ʌ':'ᶺ',
  'ɑ':'ᵅ',
  'ɔ':'ᵓ',
  'o':'ᵒ',
  'ʊ':'ᶷ',
  'u':'ᵘ',
  'b':'ᵇ',
  'p':'ᵖ',
  'd':'ᵈ',
  't':'ᵗ',
  'ʤ':'ᵈᶾ',
  'ʧ':'ᵗᶴ',
  'g':'ᶢ',
  'k':'ᵏ',
  'v':'ᵛ',
  'f':'ᶠ',
  'ð':'ᶞ',
  'θ':'ᶿ',
  'ʒ':'ᶾ',
  'ʃ':'ᶴ',
  'z':'ᶻ',
  's':'ˢ',
  'ɹ':'ʴ',
  'h':'ʰ',
  'w':'ʷ',
  'm':'ᵐ',
  'l':'ˡ',
  'n':'ⁿ',
  'j':'ʲ',
  'ŋ':'ᵑ',
  'y':'ʸ',
  'x':'ˣ',
  'c':'ᶜ',
  'r':'ʳ',
  'q':'٩'
};
//https://en.wikipedia.org/wiki/Spacing_Modifier_Letters
//https://en.wikipedia.org/wiki/Secondary_articulation

var s = ["·", "ˈ", "ˌ"];

var tone = [
  '˥', '˦', '˧', '˨', '˩',
  '꜒', '꜓', '꜔', '꜕', '꜖',
  '꜈', '꜉', '꜊', '꜋', '꜌',
  '꜍', '꜎', '꜏', '꜐', '꜑'
];
//https://en.wikipedia.org/wiki/Tone_letter

var colors = [0,1,0,1,0,0,1,0,1,0,1,0,0];
var spaces = "　 ⠀          ";
//https://en.wikipedia.org/wiki/Whitespace_character

var dots = (
	"⠀⢀⠠⢠⠐⢐⠰⢰⠈⢈⠨⢨⠘⢘⠸⢸" +
	"⡀⣀⡠⣠⡐⣐⡰⣰⡈⣈⡨⣨⡘⣘⡸⣸" +
	"⠄⢄⠤⢤⠔⢔⠴⢴⠌⢌⠬⢬⠜⢜⠼⢼" +
	"⡄⣄⡤⣤⡔⣔⡴⣴⡌⣌⡬⣬⡜⣜⡼⣼" +
	"⠂⢂⠢⢢⠒⢒⠲⢲⠊⢊⠪⢪⠚⢚⠺⢺" +
	"⡂⣂⡢⣢⡒⣒⡲⣲⡊⣊⡪⣪⡚⣚⡺⣺" +
	"⠆⢆⠦⢦⠖⢖⠶⢶⠎⢎⠮⢮⠞⢞⠾⢾" +
	"⡆⣆⡦⣦⡖⣖⡶⣶⡎⣎⡮⣮⡞⣞⡾⣾" +
	"⠁⢁⠡⢡⠑⢑⠱⢱⠉⢉⠩⢩⠙⢙⠹⢹" +
	"⡁⣁⡡⣡⡑⣑⡱⣱⡉⣉⡩⣩⡙⣙⡹⣹" +
	"⠅⢅⠥⢥⠕⢕⠵⢵⠍⢍⠭⢭⠝⢝⠽⢽" +
	"⡅⣅⡥⣥⡕⣕⡵⣵⡍⣍⡭⣭⡝⣝⡽⣽" +
	"⠃⢃⠣⢣⠓⢓⠳⢳⠋⢋⠫⢫⠛⢛⠻⢻" +
	"⡃⣃⡣⣣⡓⣓⡳⣳⡋⣋⡫⣫⡛⣛⡻⣻" +
	"⠇⢇⠧⢧⠗⢗⠷⢷⠏⢏⠯⢯⠟⢟⠿⢿" +
	"⡇⣇⡧⣧⡗⣗⡷⣷⡏⣏⡯⣯⡟⣟⡿⣿"
).split("");

var phonemes =
  "⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⡇⡇⡇⡇⡇⡇⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢸⠀⠀⠀⠀⠀⠀⠀" + "\n" +
  "⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠃⠃⡇⡇⡇⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢸⠀⠀⠀⠀⠀⠀⠀" + "\n" +
  "⠀⠀⠀⠀⠀⠀⠀⣀⣀⣤⠤⠶⠀⠀⠀⠂⠂⠃⠃⡇⡇⠀⠀⠆⠀⠀⠀⡂⡂⠂⠂⠀⠘⠘⠀⠀⠀⢀⢀⠐⠐" + "\n" +
  "⣀⣤⠤⠶⠒⠛⠉⠉⠀⠀⠀⠀⠀⠀⡀⠃⡃⠀⡀⠇⡇⠀⡄⡀⡆⡁⠀⡄⡂⡁⠅⠀⠀⢀⠀⢰⠰⢐⠐⢈⠈";
  
/*
uuooaaeaeeii sztdszfv wyrl mnnh cj bpdtgk
: : : re : :   hhhh          g  hh
*/

var phonemes_ = phonemes.split("\n");
for (var i=0; i<phonemes_.length; i++) {
  phonemes_[i] = phonemes_[i].split("");
}

var keysPressed = new Array(8);
var kbrd = {
  '1': 0,
  '2': 4,
  'q': 1,
  'w': 5,
  'a': 2,
  's': 6,
  'z': 3,
  'x': 7,
}
for (var i=0; i<keysPressed.length; i++) {
  keysPressed[i] = false;
}

var h_ = 2048;
var real = new Float32Array(h_);
var imag = new Float32Array(h_);
var fund = 128;
var freq = 4.0; //max.freq is 4*2048=8192
var offset = fund / freq;
var formant_w = Math.round(512 / freq);
var vol = 1.0;
var ac = null;
var osc, gain, osc_, gain_;
var i_, _i, t;
var a_ = [];
var playNow = false;
var h = 16;

function init() {
  ac = new AudioContext({latencyHint:"interactive",sampleRate: 48000});
  osc = ac.createOscillator();
  osc.frequency.setValueAtTime(freq, ac.currentTime); // value in hertz
  gain = ac.createGain();
  gain.gain.setValueAtTime(0, ac.currentTime);
  osc.connect(gain);
  gain.connect(ac.destination);
  osc.start();
  osc_ = ac.createOscillator();
  osc_.frequency.setValueAtTime(freq, ac.currentTime); // value in hertz
  gain_ = ac.createGain();
  gain_.gain.setValueAtTime(0, ac.currentTime);
  osc_.connect(gain_);
  gain_.connect(ac.destination);
  osc_.start();
  i_ = 0;
  _i = 0;
}

function play() {
  var ph = a_[i_].split("").reverse();
  var n = a_[i_].replace(/0/g, "").length;
  for (var i=0; i<offset; i++) {
    real[i] = 0;
    imag[i] = 0;
  }
  for (var j=0; j<ph.length; j++) {
    if (ph[0]=="1" || n<=2) {
      if (ph[j]=="1") {
        for (var i=j*formant_w+offset; i<(j+1)*formant_w+offset; i++) {
          if (parseInt(i/offset) == i/offset) {
            real[i] = vol;
          	imag[i] = vol;
          } else {
            real[i] = 0;
        	  imag[i] = 0;
          }
        }
      } else {
        for (var i=j*formant_w+offset; i<(j+1)*formant_w+offset; i++) {
          real[i] = 0;
        	imag[i] = 0;
        }
      }
    } else {
      if (ph[j]=="1") {
        for (var i=j*formant_w+offset; i<(j+1)*formant_w+offset; i++) {
        	real[i] = Math.random()*vol;
        	imag[i] = Math.random()*vol;
        }
      } else {
        for (var i=j*formant_w+offset; i<(j+1)*formant_w+offset; i++) {
          real[i] = 0;
        	imag[i] = 0;
        }
      }
    }
  }
  var wave = ac.createPeriodicWave(real, imag, {disableNormalization: true});
  if (parseInt(i_/2) == i_/2) {
    gain.gain.value = 0.0;
    osc.setPeriodicWave(wave);
    gain.gain.linearRampToValueAtTime(1.0, ac.currentTime+1.0 / freq);
    gain_.gain.linearRampToValueAtTime(0.0, ac.currentTime+1.0 / freq);
  } else {
    gain_.gain.value = 0.0;
    osc_.setPeriodicWave(wave);
    if (a_[i_-1].indexOf("1")>-1) {
      gain_.gain.linearRampToValueAtTime(1.0, ac.currentTime+1.0 / freq);
      gain.gain.linearRampToValueAtTime(0.0, ac.currentTime+1.0 / freq);
    } else {
      gain_.gain.linearRampToValueAtTime(1.0, ac.currentTime);
      gain_.gain.linearRampToValueAtTime(0.0, ac.currentTime+0.5 / freq);
      gain.gain.linearRampToValueAtTime(0.0, ac.currentTime);
    }
  }
  i_++;
  if (i_ < _i) {
    if (parseInt(i_/2) == i_/2) {
      b.focus();
      b.setSelectionRange(i_/2, i_/2);
    }
    t = setTimeout(play, 1000 / freq);
  } else {
    pause();
  }
}

function toBinary(v) {
  var a = v.split("\n");
  a_ = [];
  for (var i=0; i<a.length; i++) {
    a[i] = a[i].split("");
    for (var j=0; j<a[i].length; j++) {
      if (!a_[j*2]) {
        a_[j*2] = "";
        a_[j*2+1] = "";
      }
      var b_ = dots.indexOf(a[i][j]).toString(2);
      while (b_.length<8) {
        b_ = "0" + b_;
      }
      a_[j*2] += b_.slice(0,4);
      a_[j*2+1] += b_.slice(-4);
    }
  }
  for (var i=0; i<a_.length; i++) {
    while (a_[i].length<16) {
      a_[i] = "0" + a_[i];
    }
  }
  console.log(a_.join("\n"));
}

function showColumn() {
  var b_ = parseInt(b.selectionStart);
  var d_ = parseInt(b.selectionEnd);
  var ch_ = b.value.charAt(b_);
  ch.innerHTML = ch_;
  var c = dots.indexOf(ch_);
  if (c == -1) {
    c = 0;
  }
  var p = c.toString(2);
  while (p.length < cb.length) {
    p = "0" + p;
  }
  for (var i=0; i<p.length; i++) {
    if (p.charAt(i) == "1") {
      cb[i].checked = true;
    } else {
      cb[i].checked = false;
    }
  }
}

function addColumn() {
  b_old = b.value;
  var b_ = parseInt(b.selectionStart);
  var d_ = parseInt(b.selectionEnd);
  var l = b.value.substr(0, b_).split("\n");
  var c = l[l.length-1].length; //distance from the left
  
  var a = b.value.split("\n");
  for (var i=0; i<phonemes_.length; i++) {
    a[i] = a[i].substr(0, c) + phonemes_[i][i_/2] + a[i].substr(c+1);
  }
  b.value = a.join("\n");
  
  b.focus();
  b.setSelectionRange(c, c);
  var ch_ = b.value.charAt(b_);
  ch.innerHTML = ch_;
}

function playPhoneme(p) {
  i_ = p*2;
  _i = i_+2;
  toBinary(phonemes);
  if (ctl==b) {
    addColumn();
  }
  if (a_[i_]) {
    if(ac==null){init();}
    play();
  }
}

function playColumn() {
  i_ = findC(b)*2;
  _i = i_+2;
  toBinary(b.value);
  if (a_[i_]) {
    play();
  }
}

function playAll() {
  i_ = findC(b)*2;
  _i = a_.length;
  toBinary(b.value);
  if (a_[0]) {
    play();
  }
  playNow = true;
  document.getElementById("play_all").firstChild.innerText='pause';
}

function pause() {
  clearTimeout(t);
  gain_.gain.linearRampToValueAtTime(0.0, ac.currentTime+1.0 / freq);
  gain.gain.linearRampToValueAtTime(0.0, ac.currentTime+1.0 / freq);
  playNow = false;
  document.getElementById("play_all").firstChild.innerText='play_arrow';
}

function findC(v) {
    var b_ = parseInt(v.selectionStart);
    var d_ = parseInt(v.selectionEnd);
    var l = v.value.substr(0, b_).split("\n");
    var c = l[l.length-1].length;
    v.focus();
    v.setSelectionRange(b_, d_);
    return c;
}

function addBinary() {
  b_old = b.value;
  var b_ = parseInt(b.selectionStart);
  var d_ = parseInt(b.selectionEnd);
  var p = "";
  for (var i=0; i<keysPressed.length; i++) {
    if (keysPressed[i]===true) {
      p += "1";
    } else {
      p += "0";
    }
  }
  if (p=="00000000") {
    p = "";
    for (var i=0; i<cb.length; i++) {
      if (cb[i].checked === true) {
        p += "1";
      } else {
        p += "0";
      }
    }
  } else {
    for (var i=0; i<cb.length; i++) {
      if (p.charAt(i)=="1") {
        cb[i].checked = true;
      } else {
        cb[i].checked = false;
      }
    }
  }
  var i = parseInt(p, 2);
  b.value = b.value.substr(0, b_) + dots[i] + b.value.substr(d_+1);
  b.focus();
  b.setSelectionRange(b_, b_);
  var ch_ = b.value.charAt(b_);
  ch.innerHTML = ch_;
}

function zoom(v) {
  var z = parseInt(b.style.fontSize.slice(0,-2)) + v;
  b.style.fontSize = z+"px";
}

function swap() {
  if (checkboxes.style.left=="0px") {
    checkboxes.style.right="0px";
    checkboxes.style.left="auto";
    b.style.textAlign="left";
    buttons.style.textAlign="left";
  } else {
    checkboxes.style.right="auto";
    checkboxes.style.left="0px";
    b.style.textAlign="right";
    buttons.style.textAlign="right";
  }
}

function save() {
    var filename = "formants.txt";
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(b.value));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
}

function playAudio() {
  document.getElementsByTagName('audio')[0].play();
}

/*

use CMU->IPA / add Britfone ?
ˈaɪ
ˈaʊ
ˈeɪ
ˈiː
ˈuː
ˈæ
ˈɐ
ˈɑː
ˈɒ
ˈɔɪ
ˈɔː-
ˈə
ˈəʊ
ˈɛ
ˈɛə-
ˈɜː-
ˈɪ
ˈɪə-
ˈʊ
ˈʊə-
(aə, oə ?)
Diphtong sound

| IY IH EY EH AE ER AH AA AO OW UH UW |
| i: i  e: e  æ  ə  a  a: o  o: u  u: | F2
| D# C# B  A  G  F  D# C# B  A  G  F  |
|    2100      1400               700 | Hz

Intelligibility is preserved across a fairly wide range when F0 and FFs are scaled up or down in proportionate amounts (e.g., Chiba and Kajiyama, 1941; Daniloff et al., 1968). However, F0 and FFs do not scale proportionately in natural speech. For example, the F0 difference between adult male and adult female voices is about 80%–90%, while FFs increase only 12%–15% (Peterson and Barney, 1952).


People have a tendency to think of intonation as being directly linked to the speaker's emotions. In fact, the meaning of intonation contours is as conventionalized as any other aspect of language. Different languages can use different conventions, giving rise to the potential for cross-cultural misunderstandings.

reading the one language with the intonation pattern appropriate to the other can give rise to entirely unintentional effects: English with Russian intonation sounds unfriendly, rude or threatening, to the native speaker of English; Russian with an English intonation sounds affected or hypocritical to the native speaker of Russian.
Comrie (1984); "Interrogativity in Russian"


whistled language
In a non-tonal language, segments may be differentiated as follows:
-Vowels are replaced by a set of relative pitch ranges generally tracking the f2 formant of spoken language.
-Stress is expressed by higher pitch or increased length
-Consonants are produced by pitch transitions of different lengths and height, plus the presence or absence of occlusion. ("Labial stops are replaced by diaphragm or glottal occlusions.")


noun, adjective, verb, adverb, pronoun,
determiner, preposition, conjunction, interjection

*/

google.charts.load('current', {packages:["orgchart"]});

var url = "https://script.google.com/macros/s/AKfycbz5br4wnfSGtucWKwGQq1Tb07eshJez6uVaFatn4xJAc_rcrcA/exec"; //"http://192.168.0.61:8080/";
var fbase = "https://freealise-181308.firebaseio.com/cmudict/";
var base = "https://docs.google.com/spreadsheets/d/1lx3voPc-GWdzkhiCetUh0UGtU5FzdnAVMH6YZ4qBQrQ/gviz/tq?tqx=out:csv&gid=";
var gid = "2110937646";
var gid_ = "841483007";
var words_ = [];
var w = [];
var phoneme = [];

var k = document.getElementById("keys");
var k_ = document.getElementById("keys_");
var v = document.getElementById("keys").querySelectorAll("select");
var c_ = document.getElementById("keys_").querySelectorAll("a");
var tone_ = document.getElementById("tone");
var vowels = document.getElementById("vowels");
var consonants = document.getElementById("consonants");
var vowels_ = document.getElementById("vowels_");
var consonants_ = document.getElementById("consonants_");
var _vowels = document.getElementById("_vowels");
var _consonants = document.getElementById("_consonants");
var word = document.getElementById("word");
var _word = document.getElementById("_word");
var word_ = document.getElementById("word_");
var highlight = document.getElementById("highlight");
var sidebar = document.getElementById("sidebar");
var translations = document.getElementById("translations");
var dict = document.getElementById("dict");
var res = document.getElementById("res");
var phrase = document.getElementById("phrase");
var ngram = document.getElementById("ngram");
var corpus = document.getElementById("corpus");
var chart_ = document.getElementById("chart_");
var translation = document.getElementById("translation");
var translation_ = document.getElementById("translation_");
var languages = document.getElementById("languages");
var pos = document.getElementById("pos");
var pos_ = document.getElementById("pos_");
var syntax = document.getElementById("syntax");
var syntax_chart = document.getElementById("syntax_chart");
var spellcheck = document.getElementById("spellcheck");
var examples = document.getElementById("examples");
var wiki = document.getElementById("wiki");
var mobile = document.getElementById("mobile");
var spectrogram = document.getElementById("spectrogram");
var b = document.getElementById("b");
var buttons = document.getElementById("buttons");
var checkboxes = document.getElementById("checkboxes");
var cb = document.getElementsByClassName("cb");
var ch = document.getElementById("ch");
var res_old = "";
var b_old = "";
var regexp = [];
var ks_ = [];
var ctl = res;
var ln = 20;
var wn = 0;
var tl = ["en", "nl"]; //fy
var sl = "cs";
var orig, corr;
var a_c = false;

b.style.fontSize = "16px";
b.value = "⠀\n⠀\n⠀\n⠀\n";
var r_ = new RegExp("("+Object.keys(superscript).join("|")+")", "g");

for (var i=0; i<keys.length; i++) {
  var ks = keys[i].split(";");
  var lnk = v[i];
  lnk.id = i;
  ks_[i] = ks[0].trim();
  lnk.title = ks_[i];
  phoneme[i] = ks[7];
  lnk.onfocus = function(e){this.selectedIndex=-1;};
  lnk.onblur = function(e){this.selectedIndex=0;};
  lnk.onchange = function(e){if(ctl!=consonants && ctl!=b){addPhoneme(e.target.value, e.target.style.backgroundColor);}playPhoneme(parseInt(phoneme[this.id]));this.blur();};
  var bg = 100 - Math.pow(parseFloat(ks[3]), 1/3)*50;
  lnk.style.backgroundColor = "hsl(" + ks[2] + ", 100%, " + bg + "%)";
  lnk.innerHTML += "<option style='background-color:hsl("+ks[2]+", 100%, "+bg+"%);' value='"+ks_[i]+"_'>"+ks[0]+"</option>";
  for (var j=0; j<=2; j++) {
    var bg = 100 - Math.pow(parseFloat(ks[4+j]), 1/3)*50;
    lnk.innerHTML += "<option style='background-color:hsl("+ks[2]+", 100%, "+bg+"%);' value='"+ks_[i]+s[j]+"'>"+ks[0]+s[j]+"</option>";
  }
  regexp[i] = [];
  regexp[i][0] = new RegExp("("+ks_[i]+"[_·ˈˌ]*|"+superscript[ks_[i]]+"[ˊ`]*)", "g");
  regexp[i][1] = "hsl(" + ks[2] + ", 100%, 75%)";
}

for (var i=0; i<keys_.length; i++) {
  var ks = keys_[i].split(",");
  var lnk = c_[i];
  lnk.id = keys.length+i;
  phoneme[keys.length+i] = ks[3];
  lnk.onclick=function(e){if(ctl!=vowels && ctl!=b){addPhoneme(e.target.title, 'transparent');}playPhoneme(parseInt(phoneme[this.id]));};
  lnk.href="javascript:";
  lnk.innerText = ks[0] + " ";
  lnk.title = ks[0];
  var bg = 100 - Math.pow(parseFloat(ks[2]), 1/3)*100;
  lnk.style.color = "hsl(0, 0%, " + bg + "%)";
}

for (var i=0; i<spaces.length; i++) {
  var ks = spaces.charAt(i);
  tone_.innerHTML += "<a title='"+ks+"' href='javascript:' onclick='addPhoneme(this.title);colorPhonemes();' style='position:relative;top:-"+i+"px;color:rgba(0,0,0,"+(colors[i]*0.75+0.25)+");'>_</a> ";
}

function findCursor(v) {
    var startPos = v.selectionStart;
    var endPos = v.selectionEnd;
    return startPos + "," + endPos;
}

function selectText() {
    var txt = "";

    if (window.getSelection) {
        txt = window.getSelection();
    }
    else if (document.getSelection) {
        txt = document.getSelection();
    } else if (document.selection) {
        txt = document.selection.createRange().text.trim();
    }

    return txt;
}

function addWord(w_, _w) {
  //t.innerHTML += "<span style='background-color:" + clr + ";'>" + v + "</span> ";
  var cPos = findCursor(phrase).split(",");
  var b = parseInt(cPos[0]);
  var d = parseInt(cPos[1]);
  if (w_.search(/\D/g) != -1) {
    phrase.value = phrase.value.substr(0, b) + w_.split(' ')[0] + phrase.value.substr(d);
    phrase.focus();
    phrase.setSelectionRange(d+w_.length+1, d+w_.length+1);
    word_.firstChild.innerText = w_.split(' ')[0];
  }
  word.value = _w;
}

function addPhoneme(p, clr) {
  //t.innerHTML += "<span style='background-color:" + clr + ";'>" + v + "</span> ";
  var cPos = findCursor(ctl).split(",");
  var b = parseInt(cPos[0]);
  var d = parseInt(cPos[1]);
  ctl.value = ctl.value.substr(0, b) + p + ctl.value.substr(d);
  ctl.focus();
  ctl.setSelectionRange(b+p.length+1, b+p.length+1);
}

function findWords() {
  //https://developers.google.com/chart/interactive/docs/querylanguage#where
  var query = null;
  if (word.value != "" && word.value.trim().search(/[_·ˈˌ ]/) != -1) {
    var w_ = word.value.replace(/\s+/g, " ").replace(/_/g, "[^ ]+").replace(/\*/g, ".*").trim();
    query = "select A, D where A matches '" + w_ + "'";
  } else if (vowels.value != "" || consonants.value != "") {
    if (vowels.value != "") {
      var q = vowels.value.replace(/[_·ˈˌ]/g, function(x){return x+" ";}).replace(/\s+/g, " ").replace(/_/g, "[^ ]+").replace(/\*/g, ".*").trim();
    } else {
      var q = ".*";
    }
    if (consonants.value != "") {
      var q_ = consonants.value.split("").join(" ").replace(/\s+/g, " ").replace(/_/g, "[^ ]").replace(/\*/g, ".*").trim();
    } else {
      var q_ = ".*";
    }
    query = "select A, D where B matches '" + q + "' and C matches '" + q_ + "'";
  }
  if (query != null) {
    word_.innerHTML = "<div>Searching...</div>";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        if (this.responseText != "") {
          var r = this.responseText.slice(1,-1).replace(/","/g, "'>").replace(/"\n"/g, "</li><li title='");
          word_.innerHTML = "<div onclick='showList();'>=> Results</div><ul><li title='" + r + "</li></ul>";
          r = null;
        } else {
          word_.innerHTML = "<div>!= Nothing found</div>";
        }
        word_.focus();
      }
    };
    xhttp.open("GET", base + gid + "&tq=" + encodeURIComponent(query), true);
    xhttp.send();
  }
}

function splitWord() {
  vowels.value = "";
  consonants.value = "";
  var wrd = word.value.split(" ");
  for (var i=0; i<wrd.length; i++) {
    if (wrd[i].search(/[_·ˈˌ]/) != -1) {
      vowels.value += wrd[i];
    } else {
      consonants.value += wrd[i];
    }
  }
  vowels.value = vowels.value.trim();
  consonants.value = consonants.value.trim();
  word.value = "";
}

function highlightText() {
  var d = findCursor(res).split(',')[1];
  var b_ = res.value.substr(0, d).split("\n");
  var ln = b_[b_.length-2];
  
  if (ln.search(/\w/gi) >= 0 && ln.search(/[ˊ`_·ˈˌ]/g) == -1) {
    var wrd_ = ln.replace(/[\,\.\?\!]/g, "").split(" ");
    res.value = res.value.substr(0, d) + "…" + res.value.substr(d);
    loadTranscription(ln, wrd_, wrd_.length-1);
  }
  
  hl.scrollTop = res.scrollTop;
  hl.scrollLeft = res.scrollLeft;
}

function loadTranscription(ln, wrd_, count) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      if (this.responseText != "") {
        var r = this.responseText.replace(r_, function (x){return superscript[x];}).replace(/[\s\"]/g, "");
        res.value = res.value.replace(ln+"\n…", ln+"\n…"+r+" ");
        count--;
        if (count>=0) {
          loadTranscription(ln, wrd_, count);
        } else {
          res.value = res.value.replace(ln+"\n…", ln+"\n");
          colorPhonemes();
        }
      }
    }
  };
  //var query = "select A where D = '" + wrd_[count].toLowerCase() + "' limit 1";
  //xhttp.open("GET", base + gid_ + "&tq=" + encodeURIComponent(query), true);
  xhttp.open("GET", fbase + wrd_[count].toLowerCase() + "/0.json", true);
  xhttp.send();
}

function colorPhonemes() {
  res_old = res.value;
  var str = res.value;
  var r = new RegExp("["+spaces+"]", "g");
  var lines = str.split("\n");
  str = "";
  for (var j=0; j<lines.length; j++) {
    if (lines[j].search(/[^\s⠀]/g) == -1) {
      lines[j] = lines[j].replace(r, function (x) {
        var i_ = spaces.indexOf(x);
        var x_ = spaces.length - i_;
        x = "_";
        for (var i=0; i<x_; i++) {
          x = "<b>"+x+"</b>";
        }
        return "<span style='color:rgba(0,0,0,"+(colors[i_]*0.75+0.25)+");'>"+x+"</span>";
      });
    } else if (lines[j].search(/[ˊ`_·ˈˌ]/g) != -1) {
      for (var i=0; i<regexp.length; i++) {
        lines[j] = lines[j].replace(regexp[i][0], function (x) {
            return "<i style='border-bottom:4px solid " + regexp[i][1] + ";'>"+x+"</i>";
        });
      }
      var k = Object.keys(superscript);
    }
    str += lines[j]+"\n";
  }
  str = str.slice(0, -1);
  hl.innerHTML = str;
  hl.scrollTop = res.scrollTop;
  hl.scrollLeft = res.scrollLeft;
}

function undo() {
  if (ctl == res) {
    res.value = res_old;
    highlightText();
  } else if (ctl == b) {
    b.value = b_old;
  }
}

function loadDefinition(w_) {
  translations.style.visibility='visible';
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      if (this.responseText != "") {
        var json = JSON.parse(this.responseText)[0];
        translation.innerHTML = "<b>" + json.word + "</b><i class='material-icons notranslate'>volume_up</i> ";
        for (var i=0; i<json.phonetics.length; i++) {
          translation.innerHTML += "<audio><source src='"+json.phonetics[i].audio+"' type='audio/mpeg'></audio><a href='javascript:playAudio();'>" + json.phonetics[i].text + "</a> ";
        }
        for (var i=0; i<json.meanings.length; i++) {
          translation.innerHTML += "<hr/><b>" + json.meanings[i].partOfSpeech + "</b>";
          for (var j=0; j<json.meanings[i].definitions.length; j++) {
            translation.innerHTML += "<br/><br/>" + json.meanings[i].definitions[j].definition + "<br/>";
            for (var k=0; k<json.meanings[i].definitions[j].synonyms.length; k++) {
              translation.innerHTML += "<i><u><a href='javascript:' onclick='word.value=this.innerText;'>" + json.meanings[i].definitions[j].synonyms[k] + "</a></u></i> ";
            }
          }
        }
      } else {
        translation.innerHTML = "Unknown word";
      }
    }
  };
  xhttp.open("GET", "https://api.dictionaryapi.dev/api/v2/entries/en/" + w_, true);
  xhttp.send();
}


function loadInflections(txt) {
  var tl_ = corpus.options[corpus.selectedIndex].value;
  ngram.innerHTML = "<option>Loading...</option>";
  var txt_ = txt.split('_')[0].split(' ');
  txt = txt_[txt_.length-1];
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      ngram.innerHTML = this.responseText;
      ngram.disabled=false;
    }
  };
  xhttp.open("GET", url + "?a=phrases&w=" + txt + "_INF&tl=" + tl_, true);
  xhttp.send();
}


function loadIndex(txt, i) {
  if (txt.indexOf(" ") == -1) {
    a_c = true;
    vowels.blur();
    consonants.blur();
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var r = this.responseText.slice(1,-1).replace(/"\n"/g, "</option><option>");
        if (i=="A") {
          vowels_.innerHTML = "<option>" + r + "</option>";
          vowels.focus();
        } else {
          consonants_.innerHTML = "<option>" + r + "</option>";
          consonants.focus();
        }
      	r = null;
      	a_c = false;
      }
    };
    var query = "select "+i+" where "+i+" contains '" + txt + "'";
    xhttp.open("GET", base + gid_ + "&tq=" + encodeURIComponent(query), true);
    xhttp.send();
  }
}


function autoCompleter(txt) {
  if (txt.indexOf(" ") == -1) {
    a_c = true;
    word.blur();
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var r = this.responseText.slice(1,-1).replace(/","/g, "'>").replace(/"\n"/g, "</option><option value='");
        _word.innerHTML = "<option value='" + r + "</option>";
      	r = null;
      	a_c = false;
      	word.focus();
      }
    };
    var query = "select A, D where D contains '" + txt + "'";
    xhttp.open("GET", base + gid + "&tq=" + encodeURIComponent(query), true);
    xhttp.send();
  }
}


function loadWords() {
  word_.innerHTML = "<div>Loading...</div>";
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var r = this.responseText.slice(1,-1).replace(/","/g, "'>").replace(/"\n"/g, "</li><li title='").replace(/>\w+ /g, " class='d'>");
      word_.innerHTML = "<div onclick='showList();'><i class='material-icons notranslate'>bookmark_border</i>&nbsp;Dictionary</div><hr size='2' width='"+(wn/ln)+"'><ul><li title='' onclick='if(wn>0){wn-=ln;loadWords();}'>…</li><li title='" + r + "</li><li title='' onclick='wn+=ln;loadWords();'>…</li></ul>";
      words_ = this.responseText.replace(/".+",/g, "").replace(/".+\s\d"\n?/g, "").replace(/"/g, "").split("\n");
    }
  };
  var query = "select A, D limit " + ln + " offset " + wn;
  xhttp.open("GET", base + gid + "&tq=" + encodeURIComponent(query), true);
  xhttp.send();
}

function loadLanguages() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      languages.innerHTML = this.responseText;
      for (var i=0; i<languages.options.length; i++) {
        if (navigator.language.indexOf(languages.options[i].value) >= 0 && navigator.language.indexOf(tl[0]) == -1) {
        		languages.options[i].selected = true;
        		sl = languages.options[i].value;
        		langRedirect(false);
        } else if (languages.options[i].value.indexOf(sl) >= 0) {
            languages.options[i].selected = true;
        }
      }
    }
  };
  xhttp.open("GET", url + "?a=languages&tl=" + navigator.language, true);
  xhttp.send();
}


function langRedirect(u) {
  if (location.href.split("?")[0] != "https://freeali-se.translate.goog/phonetic/" || u===true) {
    window.location.replace("https://freeali-se.translate.goog/phonetic/?_x_tr_sch=http&_x_tr_sl=en&_x_tr_tl="+sl+"&_x_tr_hl="+sl+"&_x_tr_pto=ajax,nv,elem");
    //to detect by location: https://translate.googleusercontent.com/translate_p?anno=2&sl=auto&tl=en&u=http://freeali.se/phonetic&depth=1&rurl=translate.google.com&nv=1&sp=nmt4&pto=aue,ajax,boq&usg=ALkJrhgAAAAAYUnyEmwT_dUC6o42XdaOjdrM0pUIZtG3
  }
}


function loadTranslations(wrd) {
  if (sl != tl[0]) {
    translation.innerHTML = "Translating...";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var r = this.responseText.split("\n");
        if (r[0]) {
          translation.innerHTML = r[0];
          ngram.innerHTML = "<option>" + r[1].replace(/,/g, "</option><option>") + "</option>";
          ngram.disabled=false;
        } else {
          translation.innerHTML = "";
          loadTranslation(wrd);
        }
      }
    };
    xhttp.open("GET", url + "?a=translate&w=" + wrd + "&tl=" + sl + "&sl=" + tl[0], true);
    xhttp.send();
  } else {
    loadDefinition(wrd);
    return wrd;
  }
  chart_.innerHTML = '<iframe id="chart_iframe" src="https://books.google.com/ngrams/interactive_chart?content='+wrd+'_*&year_start=1500&year_end=2019&corpus=26&smoothing=0&case_insensitive=" width="100%" height="128" marginwidth=0 marginheight=0 hspace=0 vspace=0 frameborder=0 scrolling=no></iframe><br/><a href="https://books.google.com/ngrams/graph?content='+wrd+'_*&year_start=1500&year_end=2019&corpus=26&smoothing=0&case_insensitive=" target="_blank"><i class="material-icons notranslate">fullscreen</i></a>';
}


function loadTranslation(wrd) {
  if (sl != tl[0]) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        translation_.innerHTML = this.responseText + "<br/>";
      }
    };
    xhttp.open("GET", url + "?a=translate_beta&w=" + wrd.replace(/ /g, "+") + "&tl=" + sl + "&sl=" + tl[0], true);
    xhttp.send();
  } else {
    return wrd;
  }
}


function getSentence() {
  var d = findCursor(res).split(',')[1];
  var b_ = res.value.substr(0, d).replace(/[\.\?\!]/g, function(x){return x+"+";}).split("+");
  var wrd = b_[b_.length-2].trim();
  var b = res.value.indexOf(wrd);
  res.value = res.value.substr(0, b) + "…\n" + res.value.substr(b);
  colorPhonemes();
  syntax_chart.innerHTML = "Checking...";
  var wrd_ = wrd.replace(/\n\W*\n/g, "\n").replace(/\n/g, " ").replace(/[\,\"\'\-\:\;]/g, "").replace(/\?/g, " \?").replace(/[\!\.]/, function(x){return " "+x;}).split(" ");
  loadPunctuation(wrd_, 0, wrd);
}


function loadPunctuation(w, count, o) {
  if (w.length>2) {
    var q = w[count] + " * " + w[count+1];
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var r = JSON.parse(this.responseText);
        var p = "";
        for (var i=r.phrases.length-1; i>=0; i--) {
          if (r.phrases[i].tks[1].tt.search(/[\,\"\'\-\:\;]/) != -1) {
            p = r.phrases[i].tks[1].tt;
          } else if (r.phrases[i].tks[1].tt == w[count+1]) {
            p = "";
          }
        }
        w[count] = w[count] + p + " ";
        count++;
        if (w[count+2]) {
          loadPunctuation(w, count, o);
        } else {
          w[count] = w[count] + w[count+1];
          w[count+1] = "";
          loadCorrection(w.join(""), o);
        }
      }
    };
    xhttp.open("GET", "https://api.phrasefinder.io/search?corpus=eng-us&format=json&nmax=3&query=" + encodeURIComponent(q), true);
    xhttp.send();
  } else {
    loadCorrection(w.join(""), o);
  }
}


function loadCorrection(wrd, o) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      if (this.responseText == o) {
        hl.innerHTML = hl.innerHTML.replace("…\n", "");
        res.value = res.value.replace("…\n", "");
      } else {
        hl.innerHTML = hl.innerHTML.replace("…\n", "<sup>"+this.responseText+"</sup>\n");
        res.value = res.value.replace("…\n", "\n");
      }
      loadTranslation(o.replace(/\?/g, '%3F').replace(/\!/g, '%21'));
      loadSyntaxTree(this.responseText);
      
      spellcheck.innerText = "spellcheck";
      orig = null;
      corr = null;
      loadSyntaxPopularity(wrd);
      loadSyntaxPopularity(this.responseText);
    }
  };
  xhttp.open("GET", url + "?a=correct&w=" + wrd.replace(/ /g, "+") + "&tl=" + tl[0] + "&sl=" + tl[1], true);
  xhttp.send();
}


function loadSyntaxTree(wrd) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var r = this.responseText.split("\n");
      r[0] = r[0].replace(/\[{"/g, "<option>&nbsp;").replace(/"},{"/g, "</option>\n<option>&nbsp;").replace(/\w+":"\w+/g, function(x){var y=x.split('":"');return y[1]+' '+y[0];}).replace(/","/g, "</option><option>").replace(/"}\]/g, "</option>").split("\n");
      r[1] = r[1].split(" ");
      r[2] = r[2].split(" ");
      var tree = [[]];
      var wrd_ = wrd.trim().replace(/[^\w\s]/g, function(x){return " "+x;}).replace(/\s+/g, " ").split(" ");
      for (var i=0; i<r[0].length*2; i+=2) {
        tree[i] = [{'v':''+i, 'f':'<select onfocus="this.selectedIndex=-1" onblur="this.selectedIndex=0" onchange="loadWiki(this.options[this.selectedIndex].innerText);this.blur();"><optgroup label="'+r[2][i/2]+'">'+r[0][i/2]+'</optgroup></select>'}, ''+r[1][i/2]*2, ''+i];
        var j = i+1;
        tree[j] = [{'v':''+j, 'f':'<b>'+wrd_[i/2]+'</b>'}, ''+i, ''+j];
      }
      syntax_chart.innerHTML = "";
      drawChart(tree);
    }
  };
  xhttp.open("GET", url + "?a=syntax&w=" + wrd.replace(/ /g, "+") + "&tl=" + tl[0] + "&tl_=&c=1", true);
  xhttp.send();
}


      function drawChart(tree) {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Index');
        data.addColumn('string', 'Root');
        data.addColumn('string', 'ToolTip');

        // For each orgchart box, provide the name, manager, and tooltip to show.
        data.addRows(tree);

        // Create the chart.
        var chart = new google.visualization.OrgChart(document.getElementById('syntax_chart'));
        // Draw the chart, setting the allowHtml option to true for the tooltips.
        chart.draw(data, {'allowHtml':true, 'allowCollapse':true, 'size':'small', 'nodeClass':'tree', 'selectedNodeClass':'tree_selected'});
      }
      
      
function loadSyntaxPopularity(wrd) {
  var tl_ = corpus.options[corpus.selectedIndex].value;
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var r = this.responseText.split(",");
      if (!orig) {
        orig = r;
      } else {
        corr = r;
      }
      if (orig && corr) {
        if (orig.length < corr.length) {
          for (var i=orig.length; i<corr.length; i++) {
            orig[i] = 1.0;
          }
        } else if (corr.length < orig.length) {
          for (var i=corr.length; i<orig.length; i++) {
            corr[i] = 1.0;
          }
        }
        var avg = 0;
        for (var i=0; i<corr.length; i++) {
          avg += parseFloat(corr[i]) - parseFloat(orig[i]);
        }
        avg = avg / corr.length;
        if (avg > 0) {
          spellcheck.innerText = "cancel";
        } else if (avg < 0) {
          spellcheck.innerText = "flaky";
        } else {
          spellcheck.innerText = "task_alt";
        }
      }
    }
  };
  xhttp.open("GET", url + "?a=syntax&w=" + wrd.replace(/ /g, "+") + "&tl=" + tl[0] + "&tl_=" + tl_ + "&c=0", true);
  xhttp.send();
}


function loadPhrases() {
  var wrd = phrase.value;
  var tl_ = corpus.options[corpus.selectedIndex].value;
  ngram.innerHTML = "<option>Searching...</option>";
  for (var i=0; i<pos_.options.length; i++) {
    var r = new RegExp("\\"+pos_.options[i].value, "g");
    wrd = wrd.replace(r, pos_.options[i].className);
  }
  wrd = wrd.replace(/__/g, "_ _").replace(/\S_\w+_/g, function(x){return x.slice(0,-1);}).replace(/_\w+_/g, function(x){return "*"+x.slice(0,-1);}).replace(/\s/g, "+").replace(/,/g, "%2C").replace(/\*/g, "%2A");
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      ngram.innerHTML = this.responseText;
      ngram.disabled=false;
    }
  };
  xhttp.open("GET", url + "?a=phrases&w=" + wrd + "&tl=" + tl_, true);
  xhttp.send();
}


function loadWiki(q) {
  q = q.replace(/\s\w+\s/, '').replace(' ', '_').toLowerCase();
  examples.innerHTML = "<iframe id='wiki' src='https://simple.m.wikipedia.org/wiki/"+q+"' width='100%' height='256'/>";
}


function loadExamples(q) {
  examples.innerHTML = "<iframe id='wiki' src='https://en.m.wikipedia.org/w/index.php?ns0=1&search=%22"+encodeURIComponent(q)+"%22' width='100%' height='256'/>";
}


function loadQuiz(d) {
  var q = words_[parseInt(Math.random()*words_.length)];
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      if (this.responseText != "") {
        examples.innerHTML = "";
        var r = JSON.parse(this.responseText)[0];
        var r_ = [];
        for (var i=0; i<r.meanings.length; i++) {
          for (var j=0; j<r.meanings[i].definitions.length; j++) {
            if (d === true) {
              var e = r.meanings[i].definitions[j].definition;
              if (e) {r_.push(" "+e+" "+r.word+" ");}
            } else {
              var e = r.meanings[i].definitions[j].example;
              if (e) {r_.push(" "+e+" ");}
            }
          }
        }
        var q_ = new RegExp("\\W"+q+"\\W", "gi");
        examples.innerHTML = "<form onsubmit='event.preventDefault();checkCompletion(&quot;"+q+"&quot;);'>"+r_.join("<br/><br/>").replace(q_, function(x) {
       	  return x.slice(0,1)+"<input class='complete' type='text' size='"+(x.length-2)+"' style='width:"+(x.length-2)/1.67+"em' required/>"+x.slice(-1);
        })+"<br/><input id='complete' type='submit' value='>'/></form>";
        examples.scrollTop = 0;
      } else {
        examples.innerHTML = "Unknown word";
      }
    }
  };
  xhttp.open("GET", 'https://api.dictionaryapi.dev/api/v2/entries/en/'+q, true);
  xhttp.send();
}


function checkCompletion(q) {
  var completed = document.getElementsByClassName("complete");
  for (var i=0; i<completed.length; i++) {
    if (completed[i].value != q) {
      completed[i].placeholder = completed[i].value;
      completed[i].value = "";
      completed[i].focus();
      return false;
    }
  }
  loadQuiz(false);
  return true;
}


function showLyrics() {
  if (sidebar.style.display!='none') {
    sidebar.style.display='none';
    
    res.style.minWidth='100%';
    res.style.minHeight='256px';
    highlight.style.minWidth='100%';
    highlight.style.minHeight='256px';
  } else {
    sidebar.style.display='block';

    res.style.minWidth='50%';
    res.style.minHeight='128px';
    highlight.style.minWidth='50%';
    highlight.style.minHeight='128px';
  }
}

function showResources() {
  if (resources.style.visibility!='visible') {
    resources.style.visibility='visible';
  } else {
    resources.style.visibility='hidden';
  }
}

function showCredits() {
  if (credits.style.visibility!='visible') {
    credits.style.visibility='visible';
  } else {
    credits.style.visibility='hidden';
  }
}

function showLinks() {
  if (links.style.width!='144px') {
    links.style.width='144px';
  } else {
    links.style.width='24px';
  }
}

function showMobile() {
  if (mobile.style.visibility!='visible') {
    mobile.style.visibility='visible';
  } else {
    mobile.style.visibility='hidden';
  }
}

function showList() {
  if (word_.style.position!='absolute') {
    word_.style.position='absolute';
    word_.style.height='180px';
    word_.style.top='24px';
    word_.style.zIndex='1';
  } else {
    word_.style.position='relative';
    word_.style.height='18px';
    word_.style.top='0px';
    word_.style.zIndex='0';
  }
}

function showPhonemes() {
  if (dict.style.visibility!='visible') {
    dict.style.visibility='visible';
  } else {
    dict.style.visibility='hidden';
  }
}

function showSpectrogram() {
  if (spectrogram.style.visibility!='visible') {
    if(ac==null){init();}
    spectrogram.style.visibility='visible';
  } else {
    spectrogram.style.visibility='hidden';
  }
}

function showSyntax() {
  if (syntax.style.visibility!='hidden') {
    syntax.style.visibility='hidden';
  } else {
    syntax.style.visibility='visible';
  }
}

function showWords() {
  if (translations.style.display!='none') {
    translations.style.display='none';
  } else {
    translations.style.display='block';
  }
}

</script>
</body>
</html>
